<!DOCTYPE html>
<html ng-app="picalApp">
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link href='https://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>

        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
        <script src="https://cdn.firebase.com/libs/angularfire/1.1.2/angularfire.min.js"></script>

        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <meta name="msapplication-tap-highlight" content="no" />
        <title>PICAL</title>
</head>

<body ng-controller="picalCtrl">
<div id="splash-page" style="width:{{ data.Settings.fakewidth + 'px' }};">
</div>

<div id="fakebody-wrapper" style="width:{{ data.Settings.fakewidth + 'px' }};height:{{ data.Settings.fakeheight + 'px' }}">
<div id="fakebody" style="width:{{ data.Settings.fakewidth + 'px' }};height:{{ data.Settings.fakeheight + 'px' }}">

  <div id="header-bar">
    <img src="img/logo.png" style="width:55px;height:38px;";>

    <div id="sidebar-handle" xonClick="clickedSidebarHandle()" onclick="onTakePicture();">
      <img src="img/sidebar-handle.png" width="100%">
    </div>

  </div>

  <div id="moments-wrapper">

    <div id="moment-images">
      <img src="img/temp/moment-images.png" width="100%" height="100%">
    </div>

    <div id="moment-title">
      {{ data.lastmoment }}
    </div>

    <div id="profile-images">
      <span ng-repeat="joiner in thislast.joined">
        <!--
        <span ng-if="showGravatar(joiner)"><ximg src="http://www.gravatar.com/avatar/{{ joiner.userid }}?s=40&d=mm"></span>
        <span ng-if="showFacebookProfilePic(joiner)"><ximg src="http://graph.facebook.com/{{ joiner.userid }}/picture?type=square" style="width:40px;height:40px;"></span>
        <span ng-if="showTwitterProfilePic(joiner)"><ximg src="https://twitter.com/{{ joiner.userid }}/profile_image?size=normal" style="width:40px;height:40px;"></span>
        -->
      </span>
    </div>

    <div id="next-moment-wrapper">

      <div id="camera-shutter">
        <canvas id="camera" width="100%" height="100%" style="border:2px solid black"></canvas>
        <ximg src="img/shutter.png"  width="100%" height="100%">
        <div id="countdown-clock">07:06:45</div>
      </div>

      <div id="next-moment">
        <img src="img/group.png"  width="50%"><br>
        4,354<br>
        Joined<br>
        <img src="img/join.png"  width="80%">
        <p>Friday<br>4:10PM</p>
      </div>

    </div>

  </div>

  <div id="footer-bar">

    <div id="location">
      <img src="img/location.png" width="100%" onclick="checkLocale()">
    </div>

    <div id="comment">
      <img src="img/comment.png" width="100%">
    </div>

    <div id="photo">
      <img src="img/photo.png" width="100%" onclick="CanvasCamera.start(opt)">
    </div>
  </div>

    <!--
    <button ng-click="login('facebook')"><img src="img/facebook.png"></button>
    <button ng-click="login_anonymous()"><img src="img/twitter.png"></button>
    <button ng-click="login_anonymous()"><img src="img/googleplus.png"></button>
    <button ng-click="logout()"><img src="img/email.png"></button>

    <p ng-if="authData">Logged in user: <strong>{{ authData.uid }}</strong></p>
    <p ng-if="error">Error: <strong>{{ error }}</strong></p>

    <p ng-repeat="moment in moments">
      <img src="{{moment.profilepic}}">
      <img src="http://www.gravatar.com/avatar/{{moment.gravatarhash}}?s=32&d=mm">
      <span>{{moment.Name}}</span>
    </p>
    -->

  </div>
</div>
</div>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript">
app.initialize();

var picApp = angular.module("picalApp", ["firebase"]);
picApp.controller("picalCtrl", function($scope, $firebaseObject) {
  var data = new Firebase("https://pical.firebaseio.com");
  var dataObject = $firebaseObject(data);
  dataObject.$bindTo($scope, "data");
  console.log($scope);
  $scope.$watch('data.lastmoment', function() {
         onTakePicture();
   });
});

//var picApp = angular.module("picalApp", ["firebase"]);
//picApp.controller("picalCtrl", function($scope, $firebaseObject) {
//alert("Ready");
//  var data = new Firebase("https://pical.firebaseio.com");
//  var dataObject = $firebaseObject(data).$bindTo($scope, "data");
//  var user = new Firebase("https://pical.firebaseio.com/9a3221d34738e484f5529ad4fc051139");
//  var userObject = $firebaseObject(user).$bindTo($scope, "thisuser");
//  var thislast = new Firebase("https://pical.firebaseio.com/Moments/345");
//  var thislastObject = $firebaseObject(thislast).$bindTo($scope, "thislast");
//  $scope.showGravatar           = function(joiner) { return joiner.source == 'gravatar'; }
//  $scope.showFacebookProfilePic = function(joiner) { return joiner.source == 'facebook'; }
//  $scope.showTwitterProfilePic  = function(joiner) { return joiner.source == 'twitter';  }
//});

function checkLocale() {
      navigator.globalization.getLocaleName(
        function (locale) {alert('locale: ' + locale.value + '\n');},
        function () {alert('Error getting locale\n');}
      );

function onTakePicture() {
  console.log("Take a picture");
  CanvasCamera.takePicture(onTakeSuccess);
}

function onTakeSuccess(data) {
  alert("Photo taken")
  //
}


</script>
    </body>
</html>